syntax = "proto2";

package battlereplay;

message ActorInfo {
  optional int32 actor_id = 1;
  optional int32 meta_id = 2;
  optional int32 pos_index = 3;
  optional int32 area_index = 4;
  optional int32 hp = 5;
  optional int32 xp = 6;
  optional string name = 7;
  optional int32 hpMax = 8;
  optional int32 hero_id = 9;
}

message BattleReplay {
  optional int32 winner = 1;
  repeated ActorInfo init_cells = 2;
  repeated ActorInfo over_cells = 3;
  repeated RoundCmd round_cmds = 4;
}

message BattleReplayList {
  repeated BattleReplay battle_replays = 1;
}

message EffectAttachBuff {
  optional int32 buff_meta_id = 1;
  optional int32 layer_count = 2;
}

message EffectCmd {
  optional int32 target_id = 1;
  enum effect_type = 2;
  optional EffectUpdateXp update_xp = 3;
  optional EffectUpdateHp update_hp = 4;
  optional EffectAttachBuff attach_buff = 5;
  optional EffectDetachBuff detach_buff = 6;
}

message EffectDetachBuff {
  optional int32 buff_meta_id = 1;
}

message EffectUpdateHp {
  optional int32 update_hp = 1;
  optional int32 damage_meta_id = 2;
  optional int32 buff_meta_id = 3;
  optional bool is_dead = 4;
}

message EffectUpdateXp {
  optional int32 update_xp = 1;
  optional bool is_show = 2;
}

message PostEffectCmd {
  repeated EffectCmd effect_cmds = 1;
}

message PrevEffectCmd {
  repeated EffectCmd effect_cmds = 1;
}

message ReplayCmd {
  optional PrevEffectCmd prev_cmd = 1;
  optional SkillCmd skill_cmd = 2;
  optional PostEffectCmd post_cmd = 3;
}

message RoundCmd {
  repeated ReplayCmd replay_cmds = 1;
}

message SkillCmd {
  optional int32 caster_id = 1;
  optional int32 target_id = 2;
  optional int32 skill_meta_id = 3;
  repeated EffectCmd effect_cmds = 4;
}


